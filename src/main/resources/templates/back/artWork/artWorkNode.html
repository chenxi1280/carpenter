<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>layuiAdmin std - 通用后台管理模板系统（iframe标准版）</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/admin.css" media="all">
    <script type="text/javascript" th:src="@{/layuiadmin/layui/layui.js}"></script>
    <script type="text/javascript" th:src="@{/layuiadmin/jquery-3.5.1.js}"></script>
</head>




<script>

    var nodeId ;

    function mya(obj){

        var thisObj = $(obj) //js对象转jquery对象
        thisObj.parents().addClass('layui-this')
        thisObj.siblings().css("layui-nav-item layui-nav-itemed")
        // console.log(  thisObj.siblings())
        $('#video').attr("src",thisObj.attr('sr'))
        // $('#chooseText').text(thisObj.attr('chooseText'))
        nodeId = $(obj).attr("id")
    }

</script>
<body class="layui-layout-body">

<div id="LAY_app">
    <div class="layui-layout layui-layout-admin">


        <!-- 侧边菜单 -->
        <div class="layui-side layui-side-menu">
            <div class="layui-side-scroll">
                <div class="layui-logo" lay-href="/back/console">
                    <span>作品详情审核</span>
                </div>

                <ul class="layui-nav layui-nav-tree" lay-shrink="all" id="LAY-system-side-menu"
                    lay-filter="layadmin-system-side-menu">




                </ul>
            </div>
        </div>


        <!-- 主体内容 -->
        <div class="layui-body" id="LAY_app_body">

            <div>
                <p id="chooseText">

                </p>


            </div>
            <div >

                <video width="80%" height="80%" controls="controls" style="padding-left: 10%"
                       id="video" src="">
                </video>


            </div>

            <div style="padding-left: 10%; padding-top: 2% " >

                <button type="button" id="nodeyes"	class="layui-btn layui-btn-radius" >通过</button>
                <button type="button" id="nodeno"	class="layui-btn layui-btn-radius layui-btn-danger" >不通过</button>

            </div>
        </div>



    </div>
</div>



<script th:inline="javascript" >
    layui.config({
        base: '/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use('index');

    layui.use(['table', 'layer', 'laydate', 'form'], function () {
        var layer = layui.layer;

        var $ = layui.$;
        var element  = layui.element ;

        let pkArtworkId1 = [[${pkArtworkId}]];

        function funrec(obj) {
            //这样就把主窗体的值放到iframe层的隐藏控件了
            //你也可以直接拿到obj完成你的需求
            $("#hid_rec").val(obj);
        }

        $.ajax({
            type: 'post',// ajax请求的方式，post或get
            url: '/back/artWork/getArtWorkNoteS',
            // contentType: "application/json",// 默认就是表单数据(不写)，如果此时要传递的是json字符串，
            // 那么此时就用application/json,如果此时要传递图片"multipart/form-data，还有数组，集合，还有对象，那么contentType必须指定为false
            data: {
                pkArtworkId: pkArtworkId1
            },// 要上传的参数,把数组对象转换为JSON字符串
            dataType: 'json',// 服务器响应数据：json,text,html,xml
            processData: true,//布尔值,一般都不用设置，规定通过请求发送的数据是否转换为查询字符串。默认是 true。如果此时上传的时候，有图片，这里必须设置false,
            success: function (res) {// 请求成功，回调函数,data，指的就是服务器返回的数据
                let artWorkVO = res.data;
                f(artWorkVO);
                element.init('nav')


            },
        });

        function f(artWorkVo) {
            if (artWorkVo != null) {
                let  choo = []
                // if (artWorkVo.itemsText != null){
                //
                //     artWorkVo.itemsText.forEach(v => {
                //         choo.join(v.value)
                //
                //     })
                // }

                test(artWorkVo.pkDetailId, artWorkVo.videoUrl,artWorkVo.itemsText)
                if (artWorkVo.nodesVos != null) {
                    console.log(artWorkVo.nodesVos)
                    artWorkVo.nodesVos.forEach(v => {
                        f(v);
                    })
                }
            }

        }

        function test(id, videoUrl,chooseText) {
            let s = '<li  data-name="home" class="layui-nav-item layui-nav-itemed " ><a onclick="mya(this)" id="'+id+'" sr="'+videoUrl+'" chooseText="'+chooseText+'">'+ id +'</a></li>'
            $('#LAY-system-side-menu').append(s)

        }




    });


    $('#nodeyes').click( function () {
        console.log(nodeId)
        $.ajax({
            type: 'post',// ajax请求的方式，post或get
            url: '/back/artWork/upDataNode'  ,
            // contentType: "application/json",// 默认就是表单数据(不写)，如果此时要传递的是json字符串，
            // 那么此时就用application/json,如果此时要传递图片"multipart/form-data，还有数组，集合，还有对象，那么contentType必须指定为false
            data: {
                pkDetailId:nodeId,
                videoCode: '2',

            },// 要上传的参数,把数组对象转换为JSON字符串
            dataType: 'json',// 服务器响应数据：json,text,html,xml
            processData: true,//布尔值,一般都不用设置，规定通过请求发送的数据是否转换为查询字符串。默认是 true。如果此时上传的时候，有图片，这里必须设置false,
            success: function (res) {// 请求成功，回调函数,data，指的就是服务器返回的数据
                layer.msg(res.msg);
            },
        });

    })

    $('#nodeno').click( function () {
        console.log(nodeId)
        $.ajax({
            type: 'post',// ajax请求的方式，post或get
            url: '/back/artWork/upDataNode'  ,
            // contentType: "application/json",// 默认就是表单数据(不写)，如果此时要传递的是json字符串，
            // 那么此时就用application/json,如果此时要传递图片"multipart/form-data，还有数组，集合，还有对象，那么contentType必须指定为false
            data: {
                pkDetailId:nodeId,
                videoCode: '3',

            },// 要上传的参数,把数组对象转换为JSON字符串
            dataType: 'json',// 服务器响应数据：json,text,html,xml
            processData: true,//布尔值,一般都不用设置，规定通过请求发送的数据是否转换为查询字符串。默认是 true。如果此时上传的时候，有图片，这里必须设置false,
            success: function (res) {// 请求成功，回调函数,data，指的就是服务器返回的数据
                layer.msg(res.msg);
            },
        });

    })





</script>
</body>
</html>


